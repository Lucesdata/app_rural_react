import{j as s,u as r,d as w,e as L,a as h,f as I,h as M,i as l}from"./index-Dm10mRV8.js";import{p as k}from"./plantas-BSzwfbjd.js";const E=(n=200,t=500)=>{const i=Math.random()*(t-n)+n;return new Promise(o=>setTimeout(o,i))},R=async n=>(await E(),k.find(t=>t.id===n)),S=async(n,t=20)=>{await E(300,800);const i=k.find(d=>d.id===n);if(!i)return[];const o=new Date,a=[];for(let d=0;d<t;d++){const u=new Date(o);u.setMinutes(u.getMinutes()-d*5);const x=Math.random()>.2?95+Math.random()*5:80+Math.random()*15,m=x>=95?"ok":x>=85?"warning":"error",p=i.caudalDiseno*(.9+Math.random()*.2),N=50+Math.random()*50,g=2+Math.random()*3;a.push({timestamp:u.toISOString(),flow:parseFloat(p.toFixed(2)),level:parseFloat(N.toFixed(1)),pressure:parseFloat(g.toFixed(2)),quality:parseFloat(x.toFixed(1)),status:m})}return a},y="_header_neix7_9",T="_location_neix7_20",G="_tabButton_neix7_36",P="_activeTab_neix7_54",O="_tabContent_neix7_61",$="_kpiGrid_neix7_73",F="_kpiCard_neix7_80",B="_kpiValue_neix7_94",q="_kpiUnit_neix7_105",V="_kpiLabel_neix7_111",H="_readingsTable_neix7_125",U="_statusGrid_neix7_156",W="_statusChip_neix7_190",J="_statusOk_neix7_202",Q="_statusWarning_neix7_207",K="_statusError_neix7_212",Y="_infoGrid_neix7_238",e={header:y,location:T,tabButton:G,activeTab:P,tabContent:O,kpiGrid:$,kpiCard:F,kpiValue:B,kpiUnit:q,kpiLabel:V,readingsTable:H,statusGrid:U,statusChip:W,statusOk:J,statusWarning:Q,statusError:K,infoGrid:Y},z=({message:n="No hay datos disponibles",icon:t="üì≠"})=>s.jsxs("div",{className:r.feedbackContainer,"aria-live":"polite",children:[s.jsx("div",{className:r.feedbackIcon,"aria-hidden":"true",children:t}),s.jsx("p",{className:r.feedbackMessage,children:n})]}),X=({message:n="Ha ocurrido un error",error:t=null,onRetry:i=null})=>s.jsxs("div",{className:r.feedbackContainer,role:"alert","aria-live":"assertive",children:[s.jsx("div",{className:`${r.feedbackIcon} ${r.errorIcon}`,"aria-hidden":"true",children:"‚ùå"}),s.jsxs("p",{className:r.feedbackMessage,children:[n,t&&s.jsx("span",{className:r.errorDetails,children:t.message||String(t)})]}),i&&s.jsx("button",{className:`${r.btn} ${r.btnGhost} ${r.retryButton}`,onClick:i,children:"Reintentar"})]}),v=({active:n,onClick:t,children:i})=>s.jsx("button",{className:`${r.btn} ${e.tabButton} ${n?e.activeTab:""}`,onClick:t,"aria-selected":n,role:"tab",children:i}),b=({value:n,label:t,unit:i=""})=>s.jsxs("div",{className:e.kpiCard,children:[s.jsxs("div",{className:e.kpiValue,children:[n,i&&s.jsx("span",{className:e.kpiUnit,children:i})]}),s.jsx("div",{className:e.kpiLabel,children:t})]}),_=({status:n})=>{const t={ok:{label:"√ìptimo",className:e.statusOk},warning:{label:"Advertencia",className:e.statusWarning},error:{label:"Cr√≠tico",className:e.statusError}},{label:i,className:o}=t[n]||{label:"Desconocido",className:e.statusUnknown};return s.jsx("span",{className:`${e.statusChip} ${o}`,children:i})},es=()=>{const{id:n}=w(),{role:t}=L(),[i,o]=h.useState("resumen"),[a,d]=h.useState(null),[u,C]=h.useState([]),[x,m]=h.useState(!0),[p,N]=h.useState(null),g=I();h.useEffect(()=>{(async()=>{try{m(!0);const[j,A]=await Promise.all([R(n),S(n,5)]);d(j),C(A)}catch(j){console.error("Error loading plant data:",j),N("No se pudo cargar la informaci√≥n de la planta")}finally{m(!1)}})()},[n]);const f=c=>!!(t===l.ADMIN||c==="resumen"||c==="lecturas"&&[l.OPERARIO,l.ADMIN].includes(t)||c==="estado"&&[l.OPERARIO,l.ADMIN].includes(t)||c==="info"&&[l.OPERARIO,l.PRESIDENTE_JAA,l.ADMIN].includes(t)),D=()=>{if(!a)return null;switch(i){case"resumen":return s.jsxs("div",{className:e.tabContent,children:[s.jsx("h3",{children:"Resumen de la Planta"}),s.jsxs("div",{className:e.kpiGrid,children:[s.jsx(b,{value:a.estado_actual||"N/A",label:"Estado Actual",unit:a.estado_actual==="ok"?"‚úì":a.estado_actual==="warning"?"‚ö†Ô∏è":"‚ùå"}),s.jsx(b,{value:a.caudal_actual||"0",label:"Caudal",unit:"L/s"}),s.jsx(b,{value:a.nivel_cloro||"0",label:"Nivel de Cloro",unit:"mg/L"}),s.jsx(b,{value:a.ph||"0",label:"pH"})]}),s.jsxs("div",{className:e.section,children:[s.jsx("h4",{children:"√öltimas lecturas"}),u.length>0?s.jsxs("div",{className:e.readingsTable,children:[s.jsxs("div",{className:e.tableHeader,children:[s.jsx("div",{children:"Fecha"}),s.jsx("div",{children:"Caudal (L/s)"}),s.jsx("div",{children:"Cloro (mg/L)"}),s.jsx("div",{children:"pH"}),s.jsx("div",{children:"Estado"})]}),u.map((c,j)=>s.jsxs("div",{className:e.tableRow,children:[s.jsx("div",{children:new Date(c.fecha).toLocaleString()}),s.jsx("div",{children:c.caudal}),s.jsx("div",{children:c.cloro}),s.jsx("div",{children:c.ph}),s.jsx("div",{children:s.jsx(_,{status:c.estado})})]},j))]}):s.jsx("p",{children:"No hay lecturas recientes"})]})]});case"lecturas":return s.jsxs("div",{className:e.tabContent,children:[s.jsx("h3",{children:"Historial de Lecturas"}),s.jsx("p",{children:"Aqu√≠ se mostrar√° el historial completo de lecturas de la planta."})]});case"estado":return s.jsxs("div",{className:e.tabContent,children:[s.jsx("h3",{children:"Estado del Sistema"}),s.jsxs("div",{className:e.statusGrid,children:[s.jsxs("div",{className:e.statusCard,children:[s.jsx("h4",{children:"Bombas"}),s.jsx(_,{status:a.estado_bombas}),s.jsxs("p",{children:["√öltima revisi√≥n: ",new Date(a.ultima_revision).toLocaleDateString()]})]}),s.jsxs("div",{className:e.statusCard,children:[s.jsx("h4",{children:"Tanque de Almacenamiento"}),s.jsx("div",{className:e.progressContainer,children:s.jsxs("div",{className:e.progressBar,style:{width:`${a.nivel_tanque||0}%`},role:"progressbar","aria-valuenow":a.nivel_tanque||0,"aria-valuemin":"0","aria-valuemax":"100",children:[a.nivel_tanque||0,"%"]})})]}),s.jsxs("div",{className:e.statusCard,children:[s.jsx("h4",{children:"Calidad del Agua"}),s.jsx(_,{status:a.calidad_agua}),s.jsxs("p",{children:["√öltimo an√°lisis: ",new Date(a.ultimo_analisis).toLocaleDateString()]})]})]})]});case"info":return s.jsxs("div",{className:e.tabContent,children:[s.jsx("h3",{children:"Informaci√≥n de la Planta"}),s.jsxs("div",{className:e.infoGrid,children:[s.jsxs("div",{className:e.infoCard,children:[s.jsx("h4",{children:"Datos Generales"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Nombre:"})," ",a.nombre]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Ubicaci√≥n:"})," ",a.ubicacion]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Fuente de agua:"})," ",a.fuente]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Capacidad:"})," ",a.capacidad," L/s"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Poblaci√≥n servida:"})," ",a.poblacion_servida.toLocaleString()," habitantes"]})]}),s.jsxs("div",{className:e.infoCard,children:[s.jsx("h4",{children:"Contacto"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Operador:"})," ",a.operador||"No asignado"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Tel√©fono:"})," ",a.telefono||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Email:"})," ",a.email||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Horario de atenci√≥n:"})," ",a.horario_atencion||"L-V 8:00-17:00"]})]}),s.jsxs("div",{className:e.infoCard,children:[s.jsx("h4",{children:"Estad√≠sticas"}),s.jsxs("p",{children:[s.jsx("strong",{children:"En operaci√≥n desde:"})," ",new Date(a.fecha_operacion).getFullYear()]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Inversi√≥n total:"})," $",a.inversion_total?.toLocaleString()||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Eficiencia:"})," ",a.eficiencia||"N/A","%"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"√öltimo mantenimiento:"})," ",a.ultimo_mantenimiento?new Date(a.ultimo_mantenimiento).toLocaleDateString():"Nunca"]})]})]})]});default:return null}};return x?s.jsx(M,{}):p?s.jsx(X,{message:p,onRetry:()=>window.location.reload()}):a?s.jsxs("div",{className:e.plantDetail,children:[s.jsxs("header",{className:e.header,children:[s.jsx("button",{onClick:()=>g(-1),className:e.backButton,"aria-label":"Volver atr√°s",children:"‚Üê Volver"}),s.jsx("h1",{children:a.nombre}),s.jsxs("div",{className:e.plantMeta,children:[s.jsx("span",{className:e.location,children:a.ubicacion}),s.jsx(_,{status:a.estado_actual})]})]}),s.jsxs("div",{className:e.tabContainer,role:"tablist",children:[s.jsx(v,{active:i==="resumen",onClick:()=>o("resumen"),children:"Resumen"}),f("lecturas")&&s.jsx(v,{active:i==="lecturas",onClick:()=>o("lecturas"),children:"Lecturas"}),f("estado")&&s.jsx(v,{active:i==="estado",onClick:()=>o("estado"),children:"Estado"}),f("info")&&s.jsx(v,{active:i==="info",onClick:()=>o("info"),children:"Informaci√≥n"})]}),D(),s.jsxs("div",{className:e.actions,children:[[l.OPERARIO,l.ADMIN].includes(t)&&s.jsx("button",{className:r.btnPrimary,children:"Registrar Lectura"}),[l.PRESIDENTE_JAA,l.ADMIN].includes(t)&&s.jsx("button",{className:r.btnOutline,children:"Generar Reporte"}),t===l.ADMIN&&s.jsx("button",{className:r.btnDanger,children:"Editar Planta"})]})]}):s.jsx(z,{message:"No se encontr√≥ la planta solicitada"})};export{es as default};
